<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zx.lab_attendance.dao.LeaveclassmMapper">
    <resultMap id="BaseResultMap" type="com.zx.lab_attendance.entity.Leaveclassm">
        <id column="leaveclassm_id" jdbcType="VARCHAR" property="leaveclassmId" />
        <result column="student_id" jdbcType="VARCHAR" property="studentId" />
        <result column="leave_reason" jdbcType="VARCHAR" property="leaveReason" />
        <result column="leave_class" jdbcType="INTEGER" property="leaveClass" />
        <result column="leave_img" jdbcType="VARCHAR" property="leaveImg" />
        <result column="approver" jdbcType="VARCHAR" property="approver" />
        <result column="labusing_id" jdbcType="VARCHAR" property="labusingId" />
        <result column="leavedate" jdbcType="TIMESTAMP" property="leavedate" />
        <result column="leaveStatus" jdbcType="INTEGER" property="leaveStatus" />
        <association property="labusing" select="com.zx.lab_attendance.dao.LabusingMapper.selectByPrimaryKey" column="labusing_id"></association>
        <association property="studentUser" select="com.zx.lab_attendance.dao.UsersMapper.selectByPrimaryKey" column="student_id"></association>
        <association property="teacherUser" select="com.zx.lab_attendance.dao.UsersMapper.selectByPrimaryKey" column="approver"></association>
    </resultMap>

    <insert id="insertLeaveclass">
        insert into leaveclassm (leaveclassm_id, student_id, leave_reason,
      leave_class, leave_img, approver,
      labusing_id,leaveStatus,leavedate)
    values (#{leaveclassmId,jdbcType=VARCHAR}, #{studentId,jdbcType=VARCHAR}, #{leaveReason,jdbcType=VARCHAR},
      #{leaveClass,jdbcType=INTEGER}, #{leaveImg,jdbcType=VARCHAR}, #{approver,jdbcType=VARCHAR},
      #{labusingId,jdbcType=VARCHAR},#{leaveStatus,jdbcType=INTEGER},#{leavedate,jdbcType=TIMESTAMP})
    </insert>

    <select id="selectByApproverAndStu" resultMap="BaseResultMap" parameterType="java.lang.String">
        select leaveclassm_id, student_id, leave_reason,leave_class,
        leave_img, approver,labusing_id,leaveStatus,leavedate from leaveclassm
        where
        leaveStatus != 4 and
        (student_id = #{studentId,jdbcType=VARCHAR} or approver = #{studentId,jdbcType=VARCHAR})
    </select>

    <select id="selectAllBylabusing" resultMap="BaseResultMap" parameterType="java.lang.String">
        select leaveclassm_id, student_id, leave_reason,leave_class,
        leave_img, approver,labusing_id,leaveStatus,leavedate from leaveclassm
        where labusing_id = #{labusingid,jdbcType=VARCHAR}
    </select>

    <delete id="delectLabusing" parameterType="java.lang.String">
        delete from leaveclassm where labusing_id =#{labusingId,jdbcType=VARCHAR} and leaveStatus=1
    </delete>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        select leaveclassm_id, student_id, leave_reason,leave_class,
        leave_img, approver,labusing_id,leaveStatus,leavedate from leaveclassm
        where leaveclassm_id = #{LeaveclassmId,jdbcType=VARCHAR}
    </select>

    <select id="selectStudentAndLab" resultMap="BaseResultMap">
        select leaveclassm_id, student_id, leave_reason,leave_class,
        leave_img, approver,labusing_id,leaveStatus,leavedate from leaveclassm
        where student_id = #{studentId,jdbcType=VARCHAR} and labusing_id = #{labusingId,jdbcType=VARCHAR}
    </select>

    <update id="updateLeaveclassm">
    update leaveclassm
    set leaveStatus = #{leaveStatus,jdbcType=TIMESTAMP}
    where leaveclassm_id = #{leaveclassmId,jdbcType=VARCHAR}
  </update>
</mapper>